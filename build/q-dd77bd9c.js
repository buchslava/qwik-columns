import{z as l,C as S,S as v,k as A,l as b,r as I,X as f,N as d,O as p,U as R,a as n,n as m,_ as i,b as C}from"./q-8345e2da.js";import{P as r,m as T,a as z,s as k,i as O,b as y,r as L,c as N,p as V,d as P,e as E,f as x,g as D,h as G,j as M,k as F,l as U}from"./q-94000052.js";import{r as u}from"./q-a0305f31.js";import{C as Q}from"./q-cf8038ea.js";const Y=e=>{const[s,o]=l(),a=e,{phase:_}=s.game;if(_!==r.MOVING)return;let t=!1;a.code==="KeyA"?(T(s.game),t=!0):a.code==="KeyD"?(z(s.game),t=!0):a.code==="KeyS"||a.code==="Space"?s.game.phase=r.DROP:a.code==="KeyW"&&(k(s.game),t=!0),t&&window.requestAnimationFrame(()=>{u(s.game,o,s.width,s.height,s.blockSize)})},H=()=>{const e=S({width:0,height:0,game:{board:[...O],actor:{state:[...y],column:Math.floor(O[0].length/2),row:-2},phase:r.INACTIVE,savedPhase:r.INACTIVE,nextActor:L(3),score:0},blockSize:0,gameOverPopup:!1}),s=v(),o=v();return A("resize",n(()=>i(()=>Promise.resolve().then(()=>c),void 0),"s_GNeO5nO3be8",[s,e])),b("keypress",n(()=>i(()=>Promise.resolve().then(()=>c),void 0),"s_G0CYh0nsyHk",[e,o])),I(n(()=>i(()=>Promise.resolve().then(()=>c),void 0),"s_LzrfCwaFyLk",[s,e,o])),f(n(()=>i(()=>Promise.resolve().then(()=>c),void 0),"s_IHgav91uwds",[e])),f(n(()=>i(()=>Promise.resolve().then(()=>c),void 0),"s_5J1GdPz7JcQ",[e,o])),d("div",{ref:s},{class:"flex justify-center w-screen h-screen pt-5"},[e.gameOverPopup&&d("div",null,{class:"fixed top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2 z-50 w-72 opacity-60 text-center max-w-sm p-6 bg-white text-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700"},"GAME OVER",3,"eK_0"),d("div",null,null,d("svg",{ref:o},{class:"game-area",width:p(a=>a.width,[e]),height:p(a=>a.height,[e])},null,3,null),1,null),R(Q,{get game(){return e.game},blockSize:15,onStart$:n(()=>i(()=>Promise.resolve().then(()=>c),void 0),"s_xJrxY7wiGYs",[e]),onPause$:n(()=>i(()=>Promise.resolve().then(()=>c),void 0),"s_ROUfROoFvZc",[e]),onStop$:n(()=>i(()=>Promise.resolve().then(()=>c),void 0),"s_kYFzhOQnm80",[e]),[m]:{game:p(a=>a.game,[e]),blockSize:m,onStart$:m,onPause$:m,onStop$:m}},3,"eK_1")],1,"eK_2")},J=()=>{const[e]=l();N(e.game),e.gameOverPopup=!1,e.game.phase=r.MOVING},K=()=>{const[e]=l();V(e.game)};function w(e,s){if(e!=null&&e.value){const{height:o}=e.value.getBoundingClientRect(),a=s.game.board.length,_=s.game.board[0].length,t=o*5/6,h=t/a,g=h*_;s.width=g,s.height=t,s.blockSize=h}}const $=({cleanup:e})=>{const[s,o,a]=l();w(s,o);const _=setInterval(()=>{const t=o.game;if(t.phase!==r.FLYING){if(t.phase===r.MOVING)P(t)?E(t):(x(t),D(t)?(t.phase=r.INACTIVE,o.gameOverPopup=!0):t.phase=r.MATCH_REQUEST);else if(t.phase===r.DROP){const h=G(t);let g=0;for(;P(h);)E(h),g++;window.requestAnimationFrame(()=>{u(t,a,o.width,o.height,o.blockSize,g)});return}else t.phase===r.MATCH_REQUEST?M(t)(!0)?t.phase=r.COLLAPSE_REQUEST:(F(t),t.phase=r.MOVING):t.phase===r.COLLAPSE_REQUEST&&(U(t),t.phase=r.MATCH_REQUEST);window.requestAnimationFrame(()=>{u(t,a,o.width,o.height,o.blockSize)})}},700);e(()=>clearInterval(_))},j=({track:e})=>{const[s,o]=l();e(()=>s.width),e(()=>s.height),e(()=>s.game),u(s.game,o,s.width,s.height,s.blockSize)},W=()=>{const[e]=l();e.game.phase=r.INACTIVE,e.gameOverPopup=!0},q=({track:e})=>{const[s]=l();e(()=>s.gameOverPopup),s.gameOverPopup&&setTimeout(()=>{s.gameOverPopup=!1},5e3)},X=()=>{const[e,s]=l();w(e,s)},c=Object.freeze(Object.defineProperty({__proto__:null,_hW:C,s_0eJNMN0ChX4:H,s_5J1GdPz7JcQ:j,s_G0CYh0nsyHk:Y,s_GNeO5nO3be8:X,s_IHgav91uwds:q,s_LzrfCwaFyLk:$,s_ROUfROoFvZc:K,s_kYFzhOQnm80:W,s_xJrxY7wiGYs:J},Symbol.toStringTag,{value:"Module"}));export{C as _hW,H as s_0eJNMN0ChX4,j as s_5J1GdPz7JcQ,Y as s_G0CYh0nsyHk,X as s_GNeO5nO3be8,q as s_IHgav91uwds,$ as s_LzrfCwaFyLk,K as s_ROUfROoFvZc,W as s_kYFzhOQnm80,J as s_xJrxY7wiGYs};
